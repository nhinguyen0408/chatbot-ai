(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4493:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>h,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>o}),r(908),r(1506),r(5866);var a=r(3191),s=r(8716),n=r(7922),l=r.n(n),i=r(5231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);r.d(t,d);let o=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,908)),"D:\\pj-demo\\chatbot-ai\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,1506)),"D:\\pj-demo\\chatbot-ai\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["D:\\pj-demo\\chatbot-ai\\app\\page.tsx"],x="/page",h={require:r,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},1412:()=>{},3160:(e,t,r)=>{Promise.resolve().then(r.bind(r,4421))},4491:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},4421:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(326),s=r(7577);function n({currentScript:e,onScriptChange:t}){let[r,n]=(0,s.useState)(!1),[l,i]=(0,s.useState)(""),[d,o]=(0,s.useState)(null),[c,x]=(0,s.useState)(!1),h=(0,s.useRef)(null),u=async()=>{if(!l.trim()&&!d){alert("Vui l\xf2ng nhập kịch bản hoặc chọn file DOCX");return}x(!0);try{let e=new FormData;d?e.append("file",d):l.trim()&&e.append("textScript",l);let r=await fetch("/api/scripts",{method:"POST",body:e}),a=await r.json();a.success?(t(a.script),n(!1),i(""),o(null),h.current&&(h.current.value="")):alert("Lỗi: "+(a.error||"Kh\xf4ng thể xử l\xfd kịch bản"))}catch(e){console.error("Error uploading script:",e),alert("Lỗi khi tải kịch bản")}finally{x(!1)}};return(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Kịch bản đang sử dụng:"}),a.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:e?`${e.substring(0,100)}${e.length>100?"...":""}`:"Chưa c\xf3 kịch bản. Vui l\xf2ng th\xeam kịch bản để bắt đầu."})]}),a.jsx("button",{onClick:()=>n(!0),className:"ml-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:e?"Đổi kịch bản":"Th\xeam kịch bản"})]})}),r&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:e?"Đổi kịch bản":"Th\xeam kịch bản"}),a.jsx("button",{onClick:()=>n(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nhập kịch bản bằng text:"}),a.jsx("textarea",{value:l,onChange:e=>i(e.target.value),placeholder:"Nhập nội dung kịch bản tư vấn tại đ\xe2y...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:8})]}),a.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"HOẶC"}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Import file DOCX:"}),a.jsx("input",{ref:h,type:"file",accept:".docx",onChange:e=>{e.target.files&&e.target.files[0]&&o(e.target.files[0])},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),d&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Đ\xe3 chọn: ",d.name]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{onClick:u,disabled:c,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:c?"Đang xử l\xfd...":"Lưu kịch bản"}),a.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium",children:"Hủy"})]})]})]})})})]})}function l({script:e}){let[t,r]=(0,s.useState)([]),[n,l]=(0,s.useState)(""),[i,d]=(0,s.useState)(!1),o=(0,s.useRef)(null),c=async()=>{if(!n.trim()||i)return;if(!e){alert("Vui l\xf2ng th\xeam kịch bản trước khi chat");return}let a={role:"user",content:n.trim(),timestamp:new Date};r(e=>[...e,a]),l(""),d(!0);try{let s=t.map(e=>({role:e.role,content:e.content})),n=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:a.content,script:e,conversationHistory:s})}),l=await n.json();if(l.success){let e={role:"assistant",content:l.message,timestamp:new Date};r(t=>[...t,e])}else{let e={role:"assistant",content:`Lỗi: ${l.error||"Kh\xf4ng thể xử l\xfd tin nhắn. Vui l\xf2ng thử lại."}`,timestamp:new Date};r(t=>[...t,e])}}catch(t){console.error("Error sending message:",t);let e={role:"assistant",content:"Lỗi kết nối. Vui l\xf2ng kiểm tra lại API key v\xe0 thử lại.",timestamp:new Date};r(t=>[...t,e])}finally{d(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[a.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Chat với kh\xe1ch h\xe0ng"})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===t.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-8",children:[a.jsx("p",{children:"Ch\xe0o mừng bạn đến với Chatbot AI VBI!"}),a.jsx("p",{className:"mt-2 text-sm",children:"H\xe3y bắt đầu cuộc tr\xf2 chuyện bằng c\xe1ch gửi một tin nhắn."})]}):t.map((e,t)=>a.jsx("div",{className:`flex ${"user"===e.role?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`max-w-[80%] rounded-lg px-4 py-2 ${"user"===e.role?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"}`,children:[a.jsx("p",{className:"whitespace-pre-wrap",children:e.content}),a.jsx("p",{className:`text-xs mt-1 ${"user"===e.role?"text-blue-100":"text-gray-500 dark:text-gray-400"}`,children:e.timestamp.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})})]})},t)),i&&a.jsx("div",{className:"flex justify-start",children:a.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg px-4 py-2",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),a.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})}),a.jsx("div",{ref:o})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("textarea",{value:n,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())},placeholder:"Nhập c\xe2u hỏi của bạn...",disabled:i||!e,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white resize-none disabled:opacity-50 disabled:cursor-not-allowed",rows:2}),a.jsx("button",{onClick:c,disabled:i||!n.trim()||!e,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"Gửi"})]}),!e&&a.jsx("p",{className:"text-xs text-red-500 mt-2",children:"⚠️ Vui l\xf2ng th\xeam kịch bản trước khi chat"})]})]})}function i(){let[e,t]=(0,s.useState)(null);return a.jsx("main",{className:"min-h-screen p-4 md:p-8 lg:p-12 bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Chatbot AI VBI"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Ứng dụng chatbot AI tư vấn bảo hiểm VBI"})]}),a.jsx("div",{className:"mb-6",children:a.jsx(n,{currentScript:e,onScriptChange:t})}),a.jsx("div",{className:"h-[600px] md:h-[700px]",children:a.jsx(l,{script:e})})]})})}},1506:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>s});var a=r(9510);r(7272);let s={title:"Chatbot AI VBI",description:"Chatbot AI tư vấn bảo hiểm VBI"};function n({children:e}){return a.jsx("html",{lang:"vi",children:a.jsx("body",{children:e})})}},908:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(8570).createProxy)(String.raw`D:\pj-demo\chatbot-ai\app\page.tsx#default`)},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,471],()=>r(4493));module.exports=a})();