(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5895:function(e,t,r){Promise.resolve().then(r.bind(r,9201))},9201:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var a=r(7437),s=r(2265);function n(e){let{currentScript:t,onScriptChange:r}=e,[n,l]=(0,s.useState)(!1),[i,c]=(0,s.useState)(""),[d,o]=(0,s.useState)(null),[h,x]=(0,s.useState)(!1),u=(0,s.useRef)(null),g=async()=>{if(!i.trim()&&!d){alert("Vui l\xf2ng nhập kịch bản hoặc chọn file DOCX");return}x(!0);try{let e=new FormData;d?e.append("file",d):i.trim()&&e.append("textScript",i);let t=await fetch("/api/scripts",{method:"POST",body:e}),a=await t.json();a.success?(r(a.script),l(!1),c(""),o(null),u.current&&(u.current.value="")):alert("Lỗi: "+(a.error||"Kh\xf4ng thể xử l\xfd kịch bản"))}catch(e){console.error("Error uploading script:",e),alert("Lỗi khi tải kịch bản")}finally{x(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1",children:"Kịch bản đang sử dụng:"}),(0,a.jsx)("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:t?"".concat(t.substring(0,100)).concat(t.length>100?"...":""):"Chưa c\xf3 kịch bản. Vui l\xf2ng th\xeam kịch bản để bắt đầu."})]}),(0,a.jsx)("button",{onClick:()=>l(!0),className:"ml-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:t?"Đổi kịch bản":"Th\xeam kịch bản"})]})}),n&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:t?"Đổi kịch bản":"Th\xeam kịch bản"}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nhập kịch bản bằng text:"}),(0,a.jsx)("textarea",{value:i,onChange:e=>c(e.target.value),placeholder:"Nhập nội dung kịch bản tư vấn tại đ\xe2y...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:8})]}),(0,a.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:"HOẶC"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Import file DOCX:"}),(0,a.jsx)("input",{ref:u,type:"file",accept:".docx",onChange:e=>{e.target.files&&e.target.files[0]&&o(e.target.files[0])},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),d&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Đ\xe3 chọn: ",d.name]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{onClick:g,disabled:h,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:h?"Đang xử l\xfd...":"Lưu kịch bản"}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium",children:"Hủy"})]})]})]})})})]})}function l(e){let{script:t}=e,[r,n]=(0,s.useState)([]),[l,i]=(0,s.useState)(""),[c,d]=(0,s.useState)(!1),o=(0,s.useRef)(null),h=()=>{var e;null===(e=o.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{h()},[r]);let x=async()=>{if(!l.trim()||c)return;if(!t){alert("Vui l\xf2ng th\xeam kịch bản trước khi chat");return}let e={role:"user",content:l.trim(),timestamp:new Date};n(t=>[...t,e]),i(""),d(!0);try{let a=r.map(e=>({role:e.role,content:e.content})),s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e.content,script:t,conversationHistory:a})}),l=await s.json();if(l.success){let e={role:"assistant",content:l.message,timestamp:new Date};n(t=>[...t,e])}else{let e={role:"assistant",content:"Lỗi: ".concat(l.error||"Kh\xf4ng thể xử l\xfd tin nhắn. Vui l\xf2ng thử lại."),timestamp:new Date};n(t=>[...t,e])}}catch(t){console.error("Error sending message:",t);let e={role:"assistant",content:"Lỗi kết nối. Vui l\xf2ng kiểm tra lại API key v\xe0 thử lại.",timestamp:new Date};n(t=>[...t,e])}finally{d(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Chat với kh\xe1ch h\xe0ng"})}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===r.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-8",children:[(0,a.jsx)("p",{children:"Ch\xe0o mừng bạn đến với Chatbot AI VBI!"}),(0,a.jsx)("p",{className:"mt-2 text-sm",children:"H\xe3y bắt đầu cuộc tr\xf2 chuyện bằng c\xe1ch gửi một tin nhắn."})]}):r.map((e,t)=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"),children:[(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:e.content}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat("user"===e.role?"text-blue-100":"text-gray-500 dark:text-gray-400"),children:e.timestamp.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})})]})},t)),c&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg px-4 py-2",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})}),(0,a.jsx)("div",{ref:o})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("textarea",{value:l,onChange:e=>i(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x())},placeholder:"Nhập c\xe2u hỏi của bạn...",disabled:c||!t,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white resize-none disabled:opacity-50 disabled:cursor-not-allowed",rows:2}),(0,a.jsx)("button",{onClick:x,disabled:c||!l.trim()||!t,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"Gửi"})]}),!t&&(0,a.jsx)("p",{className:"text-xs text-red-500 mt-2",children:"⚠️ Vui l\xf2ng th\xeam kịch bản trước khi chat"})]})]})}function i(){let[e,t]=(0,s.useState)(null);return(0,a.jsx)("main",{className:"min-h-screen p-4 md:p-8 lg:p-12 bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Chatbot AI VBI"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Ứng dụng chatbot AI tư vấn bảo hiểm VBI"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(n,{currentScript:e,onScriptChange:t})}),(0,a.jsx)("div",{className:"h-[600px] md:h-[700px]",children:(0,a.jsx)(l,{script:e})})]})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5895)}),_N_E=e.O()}]);